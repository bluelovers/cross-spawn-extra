"use strict";
/**
 * Created by user on 2018/9/25/025.
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// @ts-ignore
const callable_instance2_1 = __importDefault(require("callable-instance2"));
const cross_spawn_1 = __importDefault(require("cross-spawn"));
const bluebird_1 = __importDefault(require("bluebird"));
exports.Bluebird = bluebird_1.default;
const strip_ansi_1 = __importDefault(require("strip-ansi"));
exports.SYM_CROSS_SPAWN = Symbol('cross-spawn');
exports.SYM_BLUEBIRD = Symbol('bluebird');
class CrossSpawnExtra extends callable_instance2_1.default {
    /**
     * create new CrossSpawnExtra with Custom CrossSpawn, Promise
     */
    constructor(cs, p) {
        super('async');
        this.default = this;
        this.spawnSync = this.sync;
        this.spawn = this.async;
        this[exports.SYM_CROSS_SPAWN] = cs || cross_spawn_1.default;
        // @ts-ignore
        this[exports.SYM_BLUEBIRD] = p || bluebird_1.default;
        [
            'core',
            'async',
            'sync',
        ].forEach(name => this[name] = this[name].bind(this));
    }
    sync(...argv) {
        // @ts-ignore
        let child = this[exports.SYM_CROSS_SPAWN].sync(...argv);
        child.then = bluebird_1.default.method((fn) => {
            delete child.then;
            return fn(child);
        });
        let [command, args, options] = argv;
        if (options && options.stripAnsi) {
            child.stderr = child.stderr && CrossSpawnExtra.stripAnsi(child.stderr);
            child.stdout = child.stdout && CrossSpawnExtra.stripAnsi(child.stdout);
        }
        return child;
    }
    async(...argv) {
        let self = this;
        let cache = {
            output: [],
            stdout: [],
            stderr: [],
        };
        let child;
        let fn = self[exports.SYM_CROSS_SPAWN];
        let ret = bluebird_1.default.resolve();
        let [command, args, options] = argv;
        // @ts-ignore
        child = fn(...argv);
        // @ts-ignore
        ret.child = child;
        child.stderrStream = child.stderr;
        child.stdoutStream = child.stdout;
        // @ts-ignore
        ret = ret.thenReturn(new bluebird_1.default(function (resolve, reject) {
            // @ts-ignore
            ret.child = child;
            [
                'stderr',
                'stdout',
            ].forEach(function (std) {
                if (child[std]) {
                    child[std].on('data', function (buf) {
                        cache[std].push(buf);
                        cache.output.push(buf);
                    });
                }
            });
            child.on('close', function (...argv) {
                child.status = argv[0];
                done('close');
                //console.debug(child.pid, 'close', argv);
            });
            child.on('exit', function (...argv) {
                child.status = argv[0];
                done('exit');
                //console.debug(child.pid, 'exit', argv);
            });
            child.on('error', function (error) {
                child.error = error;
                //done('error');
            });
            function done(event) {
                //console.log(event, child.error);
                let stderr = Buffer.concat(cache.stderr);
                let stdout = Buffer.concat(cache.stdout);
                if (options && options.stripAnsi) {
                    stderr = CrossSpawnExtra.stripAnsi(stderr);
                    stdout = CrossSpawnExtra.stripAnsi(stdout);
                }
                // @ts-ignore
                child.stderr = stderr;
                // @ts-ignore
                child.stdout = stdout;
                // @ts-ignore
                child.output = [null, stdout, stderr];
                // @ts-ignore
                child._output = cache.output;
                if (child.error) {
                    // @ts-ignore
                    child.error.child = child;
                }
                if (child.error) {
                    reject(child.error);
                }
                else {
                    resolve(child);
                }
            }
        })
            .tapCatch((e) => {
            if (e) {
                e.child = child;
            }
        }));
        // @ts-ignore
        ret.child = child;
        // @ts-ignore
        return ret;
    }
    static use(cs, p) {
        return new this(cs, p);
    }
    use(cs, p) {
        return new CrossSpawnExtra(cs, p);
    }
    core(...argv) {
        // @ts-ignore
        return this[exports.SYM_CROSS_SPAWN](...argv);
    }
    get coreSync() {
        return this[exports.SYM_CROSS_SPAWN].sync;
    }
    static stripAnsi(input, toStr) {
        if (!input) {
            return input;
        }
        let isBuffer = Buffer.isBuffer(input);
        input = input.toString();
        // @ts-ignore
        input = strip_ansi_1.default(input);
        if (isBuffer && !toStr) {
            return Buffer.from(input);
        }
        return input;
    }
}
exports.CrossSpawnExtra = CrossSpawnExtra;
exports.default = CrossSpawnExtra;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOzs7OztBQUVILGFBQWE7QUFDYiw0RUFBa0Q7QUFDbEQsOERBQXFDO0FBQ3JDLHdEQUFnQztBQUt2QixtQkFMRixrQkFBUSxDQUtFO0FBRmpCLDREQUFtQztBQVd0QixRQUFBLGVBQWUsR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDeEMsUUFBQSxZQUFZLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBZ0YvQyxNQUFhLGVBQThDLFNBQVEsNEJBQW1CO0lBNEtyRjs7T0FFRztJQUNILFlBQVksRUFBc0IsRUFBRSxDQUFvQztRQUV2RSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUE1S0EsWUFBTyxHQUFHLElBQUksQ0FBQztRQW9LL0IsY0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDdEIsVUFBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFTbEIsSUFBSSxDQUFDLHVCQUFlLENBQUMsR0FBRyxFQUFFLElBQUkscUJBQVUsQ0FBQztRQUN6QyxhQUFhO1FBQ2IsSUFBSSxDQUFDLG9CQUFZLENBQUMsR0FBRyxDQUFDLElBQUksa0JBQVEsQ0FBQztRQUVuQztZQUNDLE1BQU07WUFDTixPQUFPO1lBQ1AsTUFBTTtTQUNOLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBMUtELElBQUksQ0FBYSxHQUFHLElBQUk7UUFFdkIsYUFBYTtRQUNiLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyx1QkFBZSxDQUFDLENBQUMsSUFBSSxDQUFJLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDbkQsS0FBSyxDQUFDLElBQUks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QztJQUNkLENBQUM7Q0FDRDtBQWhRRCwwQ0FnUUM7QUFFRCxrQkFBZSxlQUFlLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgdXNlciBvbiAyMDE4LzkvMjUvMDI1LlxuICovXG5cbi8vIEB0cy1pZ25vcmVcbmltcG9ydCBDYWxsYWJsZUluc3RhbmNlIGZyb20gJ2NhbGxhYmxlLWluc3RhbmNlMic7XG5pbXBvcnQgQ3Jvc3NTcGF3biBmcm9tICdjcm9zcy1zcGF3bic7XG5pbXBvcnQgQmx1ZWJpcmQgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IGNoaWxkX3Byb2Nlc3MgZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgc3RyZWFtIGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQgc3RyaXBBbnNpIGZyb20gJ3N0cmlwLWFuc2knO1xuXG5leHBvcnQgeyBCbHVlYmlyZCB9XG5cbmltcG9ydCB7XG5cdFNwYXduT3B0aW9ucyxcblx0U3Bhd25TeW5jT3B0aW9ucyxcblx0U3Bhd25TeW5jT3B0aW9uc1dpdGhCdWZmZXJFbmNvZGluZyxcblx0U3Bhd25TeW5jT3B0aW9uc1dpdGhTdHJpbmdFbmNvZGluZyxcbn0gZnJvbSBcIi4vdHlwZVwiO1xuXG5leHBvcnQgY29uc3QgU1lNX0NST1NTX1NQQVdOID0gU3ltYm9sKCdjcm9zcy1zcGF3bicpO1xuZXhwb3J0IGNvbnN0IFNZTV9CTFVFQklSRCA9IFN5bWJvbCgnYmx1ZWJpcmQnKTtcblxuZXhwb3J0IHtcblx0U3Bhd25PcHRpb25zLFxuXHRTcGF3blN5bmNPcHRpb25zLFxuXHRTcGF3blN5bmNPcHRpb25zV2l0aEJ1ZmZlckVuY29kaW5nLFxuXHRTcGF3blN5bmNPcHRpb25zV2l0aFN0cmluZ0VuY29kaW5nLFxufVxuXG5leHBvcnQgdHlwZSBTcGF3blN5bmNSZXR1cm5zPFQgPSBCdWZmZXI+ID0gY2hpbGRfcHJvY2Vzcy5TcGF3blN5bmNSZXR1cm5zPFQ+ICYge1xuXG5cdC8qKlxuXHQgKiBmYWtlIGFzeW5jIGFwaSwgdGhpcyBub3Qgc2FtZSBhcyBhc3luYyByZXR1cm5cblx0ICovXG5cdHRoZW48Uj4oZm46IChjaGlsZDogY2hpbGRfcHJvY2Vzcy5TcGF3blN5bmNSZXR1cm5zPFQ+KSA9PiBSKTogQmx1ZWJpcmQ8Uj4sXG5cblx0ZXJyb3I6IElTcGF3bkFTeW5jRXJyb3IsXG59O1xuXG5leHBvcnQgdHlwZSBTcGF3bkFTeW5jUmV0dXJuczxUID0gQnVmZmVyPiA9IGNoaWxkX3Byb2Nlc3MuU3Bhd25TeW5jUmV0dXJuczxUPiAmIGNoaWxkX3Byb2Nlc3MuQ2hpbGRQcm9jZXNzICYge1xuXG5cdGVycm9yOiBJU3Bhd25BU3luY0Vycm9yLFxuXHRzdGF0dXM6IG51bWJlcixcblxuXHQvKipcblx0ICogYSBidWZmZXIgbGlzdCBieSByZWFseSBvcmRlciBvZiBvdXRwdXQgKGluY2x1ZGUgc3Rkb3V0ICwgc3RkZXJyKVxuXHQgKi9cblx0X291dHB1dD86IEJ1ZmZlcltdLFxuXG5cdC8qKlxuXHQgKiBzb3VyY2Ugc3RkZXJyIHN0cmVhbVxuXHQgKi9cblx0c3RkZXJyU3RyZWFtPzogc3RyZWFtLlJlYWRhYmxlLFxuXHQvKipcblx0ICogc291cmNlIHN0ZG91dCBzdHJlYW1cblx0ICovXG5cdHN0ZG91dFN0cmVhbT86IHN0cmVhbS5SZWFkYWJsZSxcbn07XG5cbmV4cG9ydCB0eXBlIFNwYXduQVN5bmNSZXR1cm5zUHJvbWlzZTxUID0gQnVmZmVyPiA9IEJsdWViaXJkPFNwYXduQVN5bmNSZXR1cm5zPFQ+PiAmIHtcblxuXHQvKipcblx0ICogY2FuIGRvIGFueXRoaW5nIGFzIHUgd2FudCBsaWtlIHNvdXJjZSBzcGF3biBkb1xuXHQgKi9cblx0Y2hpbGQ/OiBTcGF3bkFTeW5jUmV0dXJuczxUPixcblxufTtcblxuLyoqXG4gKiBFcnJvciBDbGFzc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIElTcGF3bkFTeW5jRXJyb3I8UiA9IFNwYXduQVN5bmNSZXR1cm5zPiBleHRlbmRzIEVycm9yXG57XG5cdG1lc3NhZ2U6IHN0cmluZyxcblx0Y29kZT86IHN0cmluZyxcblx0ZXJybm8/OiBzdHJpbmcsXG5cdHN5c2NhbGw/OiBzdHJpbmcsXG5cdHBhdGg/OiBzdHJpbmcsXG5cdHNwYXduYXJncz86IHN0cmluZ1tdLFxuXG5cdGNoaWxkPzogUixcbn1cblxuaW50ZXJmYWNlIENhbGxhYmxlSW5zdGFuY2U8UiA9IFNwYXduQVN5bmNSZXR1cm5zUHJvbWlzZT5cbntcblx0KGNvbW1hbmQ6IHN0cmluZywgYXJncz86IHN0cmluZ1tdLCBvcHRpb25zPzogU3Bhd25PcHRpb25zKTogU3Bhd25BU3luY1JldHVybnNQcm9taXNlXG5cdDxUID0gQnVmZmVyPihjb21tYW5kOiBzdHJpbmcsIGFyZ3M/OiBzdHJpbmdbXSwgb3B0aW9ucz86IFNwYXduT3B0aW9ucyk6IFNwYXduQVN5bmNSZXR1cm5zUHJvbWlzZTxUPlxuXHQ8VCA9IEJ1ZmZlcj4oY29tbWFuZDogc3RyaW5nLCBhcmdzPzogYW55W10sIG9wdGlvbnM/OiBTcGF3bk9wdGlvbnMpOiBTcGF3bkFTeW5jUmV0dXJuc1Byb21pc2U8VD5cblx0PFQgPSBCdWZmZXI+KGNvbW1hbmQ6IHN0cmluZywgYXJncz86IGFueVtdKTogU3Bhd25BU3luY1JldHVybnNQcm9taXNlPFQ+XG5cdDxUID0gQnVmZmVyPihjb21tYW5kOiBzdHJpbmcpOiBTcGF3bkFTeW5jUmV0dXJuc1Byb21pc2U8VD5cblxuXHQoY29tbWFuZDogc3RyaW5nLCBhcmdzPzogc3RyaW5nW10sIG9wdGlvbnM/OiBTcGF3bk9wdGlvbnMpOiBTcGF3bkFTeW5jUmV0dXJuc1Byb21pc2Vcblx0KGNvbW1hbmQ6IHN0cmluZywgYXJncz86IGFueVtdLCBvcHRpb25zPzogU3Bhd25PcHRpb25zKTogU3Bhd25BU3luY1JldHVybnNQcm9taXNlXG5cdChjb21tYW5kOiBzdHJpbmcsIGFyZ3M/OiBhbnlbXSk6IFNwYXduQVN5bmNSZXR1cm5zUHJvbWlzZVxuXHQoY29tbWFuZDogc3RyaW5nKTogU3Bhd25BU3luY1JldHVybnNQcm9taXNlXG5cblx0PFQgPSBCdWZmZXI+KC4uLmFyZ3YpOiBTcGF3bkFTeW5jUmV0dXJuc1Byb21pc2U8VD5cblx0KC4uLmFyZ3YpOiBTcGF3bkFTeW5jUmV0dXJuc1Byb21pc2Vcbn1cblxuZXhwb3J0IGNsYXNzIENyb3NzU3Bhd25FeHRyYTxSID0gU3Bhd25BU3luY1JldHVybnNQcm9taXNlPiBleHRlbmRzIENhbGxhYmxlSW5zdGFuY2U8Uj5cbntcblx0cHJvdGVjdGVkIHJlYWRvbmx5IFtTWU1fQ1JPU1NfU1BBV05dOiB0eXBlb2YgQ3Jvc3NTcGF3bjtcblx0cHJvdGVjdGVkIHJlYWRvbmx5IFtTWU1fQkxVRUJJUkRdOiB0eXBlb2YgQmx1ZWJpcmQ7XG5cblx0cHVibGljIHJlYWRvbmx5IGRlZmF1bHQgPSB0aGlzO1xuXG5cdC8qKlxuXHQgKiBzeW5jIHZlcnNpb24gb2YgY2hpbGRfcHJvY2Vzcy5zcGF3blN5bmMoY29tbWFuZFssIGFyZ3NdWywgb3B0aW9uc10pXG5cdCAqL1xuXHRzeW5jKGNvbW1hbmQ6IHN0cmluZyk6IFNwYXduU3luY1JldHVybnM8QnVmZmVyPjtcblx0c3luYyhjb21tYW5kOiBzdHJpbmcsIG9wdGlvbnM/OiBTcGF3blN5bmNPcHRpb25zV2l0aFN0cmluZ0VuY29kaW5nKTogU3Bhd25TeW5jUmV0dXJuczxzdHJpbmc+O1xuXHRzeW5jKGNvbW1hbmQ6IHN0cmluZywgb3B0aW9ucz86IFNwYXduU3luY09wdGlvbnNXaXRoQnVmZmVyRW5jb2RpbmcpOiBTcGF3blN5bmNSZXR1cm5zPEJ1ZmZlcj47XG5cdHN5bmMoY29tbWFuZDogc3RyaW5nLCBvcHRpb25zPzogU3Bhd25TeW5jT3B0aW9ucyk6IFNwYXduU3luY1JldHVybnM8QnVmZmVyPjtcblx0c3luYyhjb21tYW5kOiBzdHJpbmcsIGFyZ3M/OiBBcnJheTxzdHJpbmc+LCBvcHRpb25zPzogU3Bhd25TeW5jT3B0aW9uc1dpdGhTdHJpbmdFbmNvZGluZyk6IFNwYXduU3luY1JldHVybnM8c3RyaW5nPjtcblx0c3luYyhjb21tYW5kOiBzdHJpbmcsIGFyZ3M/OiBBcnJheTxzdHJpbmc+LCBvcHRpb25zPzogU3Bhd25TeW5jT3B0aW9uc1dpdGhCdWZmZXJFbmNvZGluZyk6IFNwYXduU3luY1JldHVybnM8QnVmZmVyPjtcblx0c3luYyhjb21tYW5kOiBzdHJpbmcsIGFyZ3M/OiBBcnJheTxzdHJpbmc+LCBvcHRpb25zPzogU3Bhd25TeW5jT3B0aW9ucyk6IFNwYXduU3luY1JldHVybnM8QnVmZmVyPjtcblx0c3luYzxUID0gQnVmZmVyPiguLi5hcmd2KTogU3Bhd25TeW5jUmV0dXJuczxUPlxuXHRzeW5jPFQgPSBCdWZmZXI+KC4uLmFyZ3YpOiBTcGF3blN5bmNSZXR1cm5zPFQ+XG5cdHtcblx0XHQvLyBAdHMtaWdub3JlXG5cdFx0bGV0IGNoaWxkID0gdGhpc1tTWU1fQ1JPU1NfU1BBV05dLnN5bmM8VD4oLi4uYXJndik7XG5cdFx0Y2hpbGQudGhlbiA9IEJsdWViaXJkLm1ldGhvZCgoZm4pID0+IHtcblx0XHRcdGRlbGV0ZSBjaGlsZC50aGVuO1xuXHRcdFx0cmV0dXJuIGZuKGNoaWxkKVxuXHRcdH0pO1xuXG5cdFx0bGV0IFtjb21tYW5kLCBhcmdzLCBvcHRpb25zXSA9IGFyZ3Y7XG5cblx0XHRpZiAob3B0aW9ucyAmJiBvcHRpb25zLnN0cmlwQW5zaSlcblx0XHR7XG5cdFx0XHRjaGlsZC5zdGRlcnIgPSBjaGlsZC5zdGRlcnIgJiYgQ3Jvc3NTcGF3bkV4dHJhLnN0cmlwQW5zaShjaGlsZC5zdGRlcnIpO1xuXHRcdFx0Y2hpbGQuc3Rkb3V0ID0gY2hpbGQuc3Rkb3V0ICYmIENyb3NzU3Bhd25FeHRyYS5zdHJpcEFuc2koY2hpbGQuc3Rkb3V0KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gY2hpbGQ7XG5cdH1cblxuXHQvKipcblx0ICogYXN5bmMgdmVyc2lvbiBvZiBjaGlsZF9wcm9jZXNzLnNwYXduKGNvbW1hbmRbLCBhcmdzXVssIG9wdGlvbnNdKVxuXHQgKi9cblx0YXN5bmM8VCA9IEJ1ZmZlcj4oY29tbWFuZDogc3RyaW5nLCBhcmdzPzogc3RyaW5nW10sIG9wdGlvbnM/OiBTcGF3bk9wdGlvbnMpOiBTcGF3bkFTeW5jUmV0dXJuc1Byb21pc2U8VD5cblx0YXN5bmM8VCA9IEJ1ZmZlcj4oY29tbWFuZDogc3RyaW5nLCBhcmdzPzogYW55W10sIG9wdGlvbnM/OiBTcGF3bk9wdGlvbnMpOiBTcGF3bkFTeW5jUmV0dXJuc1Byb21pc2U8VD5cblx0YXN5bmM8VCA9IEJ1ZmZlcj4oLi4uYXJndik6IFNwYXduQVN5bmNSZXR1cm5zUHJvbWlzZTxUPlxuXHRhc3luYzxUID0gQnVmZmVyPiguLi5hcmd2KTogU3Bhd25BU3luY1JldHVybnNQcm9taXNlPFQ+XG5cdHtcblx0XHRsZXQgc2VsZiA9IHRoaXM7XG5cblx0XHRsZXQgY2FjaGUgPSB7XG5cdFx0XHRvdXRwdXQ6IFtdIGFzIEJ1ZmZlcltdLFxuXHRcdFx0c3Rkb3V0OiBbXSBhcyBCdWZmZXJbXSxcblx0XHRcdHN0ZGVycjogW10gYXMgQnVmZmVyW10sXG5cdFx0fTtcblxuXHRcdGxldCBjaGlsZDogU3Bhd25BU3luY1JldHVybnM8VD47XG5cdFx0bGV0IGZuID0gc2VsZltTWU1fQ1JPU1NfU1BBV05dIGFzIHR5cGVvZiBDcm9zc1NwYXduO1xuXG5cdFx0bGV0IHJldCA9IEJsdWViaXJkLnJlc29sdmUoKTtcblxuXHRcdGxldCBbY29tbWFuZCwgYXJncywgb3B0aW9uc10gPSBhcmd2O1xuXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdGNoaWxkID0gZm4oLi4uYXJndik7XG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHJldC5jaGlsZCA9IGNoaWxkO1xuXG5cdFx0Y2hpbGQuc3RkZXJyU3RyZWFtID0gY2hpbGQuc3RkZXJyO1xuXHRcdGNoaWxkLnN0ZG91dFN0cmVhbSA9IGNoaWxkLnN0ZG91dDtcblxuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHRyZXQgPSByZXQudGhlblJldHVybihuZXcgQmx1ZWJpcmQ8U3Bhd25BU3luY1JldHVybnM8VD4+KGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpXG5cdFx0e1xuXHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0cmV0LmNoaWxkID0gY2hpbGQ7XG5cblx0XHRcdFtcblx0XHRcdFx0J3N0ZGVycicsXG5cdFx0XHRcdCdzdGRvdXQnLFxuXHRcdFx0XS5mb3JFYWNoKGZ1bmN0aW9uIChzdGQpXG5cdFx0XHR7XG5cdFx0XHRcdGlmIChjaGlsZFtzdGRdKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Y2hpbGRbc3RkXS5vbignZGF0YScsIGZ1bmN0aW9uIChidWYpXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0Y2FjaGVbc3RkXS5wdXNoKGJ1Zik7XG5cdFx0XHRcdFx0XHRjYWNoZS5vdXRwdXQucHVzaChidWYpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Y2hpbGQub24oJ2Nsb3NlJywgZnVuY3Rpb24gKC4uLmFyZ3YpXG5cdFx0XHR7XG5cdFx0XHRcdGNoaWxkLnN0YXR1cyA9IGFyZ3ZbMF07XG5cblx0XHRcdFx0ZG9uZSgnY2xvc2UnKTtcblxuXHRcdFx0XHQvL2NvbnNvbGUuZGVidWcoY2hpbGQucGlkLCAnY2xvc2UnLCBhcmd2KTtcblx0XHRcdH0pO1xuXG5cdFx0XHRjaGlsZC5vbignZXhpdCcsIGZ1bmN0aW9uICguLi5hcmd2KVxuXHRcdFx0e1xuXHRcdFx0XHRjaGlsZC5zdGF0dXMgPSBhcmd2WzBdO1xuXG5cdFx0XHRcdGRvbmUoJ2V4aXQnKTtcblxuXHRcdFx0XHQvL2NvbnNvbGUuZGVidWcoY2hpbGQucGlkLCAnZXhpdCcsIGFyZ3YpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGNoaWxkLm9uKCdlcnJvcicsIGZ1bmN0aW9uIChlcnJvcilcblx0XHRcdHtcblx0XHRcdFx0Y2hpbGQuZXJyb3IgPSBlcnJvcjtcblx0XHRcdFx0Ly9kb25lKCdlcnJvcicpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGZ1bmN0aW9uIGRvbmUoZXZlbnQ/OiBzdHJpbmcpXG5cdFx0XHR7XG5cdFx0XHRcdC8vY29uc29sZS5sb2coZXZlbnQsIGNoaWxkLmVycm9yKTtcblxuXHRcdFx0XHRsZXQgc3RkZXJyID0gQnVmZmVyLmNvbmNhdChjYWNoZS5zdGRlcnIpO1xuXHRcdFx0XHRsZXQgc3Rkb3V0ID0gQnVmZmVyLmNvbmNhdChjYWNoZS5zdGRvdXQpO1xuXG5cdFx0XHRcdGlmIChvcHRpb25zICYmIG9wdGlvbnMuc3RyaXBBbnNpKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0c3RkZXJyID0gQ3Jvc3NTcGF3bkV4dHJhLnN0cmlwQW5zaShzdGRlcnIpO1xuXHRcdFx0XHRcdHN0ZG91dCA9IENyb3NzU3Bhd25FeHRyYS5zdHJpcEFuc2koc3Rkb3V0KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdFx0Y2hpbGQuc3RkZXJyID0gc3RkZXJyO1xuXHRcdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHRcdGNoaWxkLnN0ZG91dCA9IHN0ZG91dDtcblx0XHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0XHRjaGlsZC5vdXRwdXQgPSBbbnVsbCwgc3Rkb3V0LCBzdGRlcnJdO1xuXG5cdFx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdFx0Y2hpbGQuX291dHB1dCA9IGNhY2hlLm91dHB1dDtcblxuXHRcdFx0XHRpZiAoY2hpbGQuZXJyb3IpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHRcdFx0Y2hpbGQuZXJyb3IuY2hpbGQgPSBjaGlsZDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChjaGlsZC5lcnJvcilcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHJlamVjdChjaGlsZC5lcnJvcik7XG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0cmVzb2x2ZShjaGlsZCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KVxuXHRcdFx0LnRhcENhdGNoKChlOiBJU3Bhd25BU3luY0Vycm9yPFNwYXduQVN5bmNSZXR1cm5zPFQ+PikgPT4ge1xuXHRcdFx0XHRpZiAoZSlcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGUuY2hpbGQgPSBjaGlsZDtcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHQpXG5cdFx0O1xuXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHJldC5jaGlsZCA9IGNoaWxkO1xuXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRzcGF3blN5bmMgPSB0aGlzLnN5bmM7XG5cdHNwYXduID0gdGhpcy5hc3luYztcblxuXHQvKipcblx0ICogY3JlYXRlIG5ldyBDcm9zc1NwYXduRXh0cmEgd2l0aCBDdXN0b20gQ3Jvc3NTcGF3biwgUHJvbWlzZVxuXHQgKi9cblx0Y29uc3RydWN0b3IoY3M/OiB0eXBlb2YgQ3Jvc3NTcGF3biwgcD86IHR5cGVvZiBCbHVlYmlyZCB8IHR5cGVvZiBQcm9taXNlKVxuXHR7XG5cdFx0c3VwZXIoJ2FzeW5jJyk7XG5cblx0XHR0aGlzW1NZTV9DUk9TU19TUEFXTl0gPSBjcyB8fCBDcm9zc1NwYXduO1xuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHR0aGlzW1NZTV9CTFVFQklSRF0gPSBwIHx8IEJsdWViaXJkO1xuXG5cdFx0W1xuXHRcdFx0J2NvcmUnLFxuXHRcdFx0J2FzeW5jJyxcblx0XHRcdCdzeW5jJyxcblx0XHRdLmZvckVhY2gobmFtZSA9PiB0aGlzW25hbWVdID0gdGhpc1tuYW1lXS5iaW5kKHRoaXMpKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBjcmVhdGUgbmV3IENyb3NzU3Bhd25FeHRyYSB3aXRoIEN1c3RvbSBDcm9zc1NwYXduLCBQcm9taXNlXG5cdCAqL1xuXHRzdGF0aWMgdXNlKGNzPzogdHlwZW9mIENyb3NzU3Bhd24sIHA/OiB0eXBlb2YgQmx1ZWJpcmQgfCB0eXBlb2YgUHJvbWlzZSk6IENyb3NzU3Bhd25FeHRyYVxuXHRzdGF0aWMgdXNlPFIgPSBTcGF3bkFTeW5jUmV0dXJuc1Byb21pc2U+KGNzPzogdHlwZW9mIENyb3NzU3Bhd24sIHA/OiB0eXBlb2YgQmx1ZWJpcmQgfCB0eXBlb2YgUHJvbWlzZSk6IENyb3NzU3Bhd25FeHRyYTxSPlxuXHRzdGF0aWMgdXNlKGNzPywgcD8pOiBDcm9zc1NwYXduRXh0cmFcblx0c3RhdGljIHVzZTxSID0gU3Bhd25BU3luY1JldHVybnNQcm9taXNlPihjcz8sIHA/KTogQ3Jvc3NTcGF3bkV4dHJhPFI+XG5cdHN0YXRpYyB1c2U8UiA9IFNwYXduQVN5bmNSZXR1cm5zUHJvbWlzZT4oY3M/OiB0eXBlb2YgQ3Jvc3NTcGF3biwgcD86IHR5cGVvZiBCbHVlYmlyZCB8IHR5cGVvZiBQcm9taXNlKVxuXHR7XG5cdFx0cmV0dXJuIG5ldyB0aGlzPFI+KGNzLCBwKVxuXHR9XG5cblx0LyoqXG5cdCAqIGNyZWF0ZSBuZXcgQ3Jvc3NTcGF3bkV4dHJhIHdpdGggQ3VzdG9tIENyb3NzU3Bhd24sIFByb21pc2Vcblx0ICovXG5cdHVzZShjcz86IHR5cGVvZiBDcm9zc1NwYXduLCBwPzogdHlwZW9mIEJsdWViaXJkIHwgdHlwZW9mIFByb21pc2UpOiBDcm9zc1NwYXduRXh0cmFcblx0dXNlPFIgPSBTcGF3bkFTeW5jUmV0dXJuc1Byb21pc2U+KGNzPzogdHlwZW9mIENyb3NzU3Bhd24sIHA/OiB0eXBlb2YgQmx1ZWJpcmQgfCB0eXBlb2YgUHJvbWlzZSk6IENyb3NzU3Bhd25FeHRyYTxSPlxuXHR1c2UoY3M/LCBwPyk6IENyb3NzU3Bhd25FeHRyYVxuXHR1c2U8UiA9IFNwYXduQVN5bmNSZXR1cm5zUHJvbWlzZT4oY3M/LCBwPyk6IENyb3NzU3Bhd25FeHRyYTxSPlxuXHR1c2U8UiA9IFNwYXduQVN5bmNSZXR1cm5zUHJvbWlzZT4oY3M/OiB0eXBlb2YgQ3Jvc3NTcGF3biwgcD86IHR5cGVvZiBCbHVlYmlyZCB8IHR5cGVvZiBQcm9taXNlKVxuXHR7XG5cdFx0cmV0dXJuIG5ldyBDcm9zc1NwYXduRXh0cmE8Uj4oY3MsIHApXG5cdH1cblxuXHRjb3JlPFQ+KGNvbW1hbmQ6IHN0cmluZywgYXJncz86IHN0cmluZ1tdLCBvcHRpb25zPzogU3Bhd25PcHRpb25zKTogY2hpbGRfcHJvY2Vzcy5DaGlsZFByb2Nlc3Ncblx0Y29yZTxUPiguLi5hcmd2KTogY2hpbGRfcHJvY2Vzcy5DaGlsZFByb2Nlc3Ncblx0Y29yZTxUPiguLi5hcmd2KTogY2hpbGRfcHJvY2Vzcy5DaGlsZFByb2Nlc3Ncblx0e1xuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHRyZXR1cm4gdGhpc1tTWU1fQ1JPU1NfU1BBV05dKC4uLmFyZ3YpO1xuXHR9XG5cblx0Z2V0IGNvcmVTeW5jKClcblx0e1xuXHRcdHJldHVybiB0aGlzW1NZTV9DUk9TU19TUEFXTl0uc3luYztcblx0fVxuXG5cdC8qKlxuXHQgKiBzdHJpcEFuc2kgYSBCdWZmZXIgb3Igc3RyaW5nXG5cdCAqL1xuXHRzdGF0aWMgc3RyaXBBbnNpKGlucHV0OiBCdWZmZXIsIHRvU3RyOiB0cnVlKTogc3RyaW5nXG5cdHN0YXRpYyBzdHJpcEFuc2koaW5wdXQ6IEJ1ZmZlciwgdG9TdHI/OiBib29sZWFuKTogQnVmZmVyXG5cdHN0YXRpYyBzdHJpcEFuc2koaW5wdXQ6IHN0cmluZywgdG9TdHI/OiBib29sZWFuKTogc3RyaW5nXG5cdHN0YXRpYyBzdHJpcEFuc2k8VD4oaW5wdXQ6IFQsIHRvU3RyOiB0cnVlKTogc3RyaW5nXG5cdHN0YXRpYyBzdHJpcEFuc2k8VD4oaW5wdXQ6IFQsIHRvU3RyPzogYm9vbGVhbik6IFRcblx0c3RhdGljIHN0cmlwQW5zaShpbnB1dDogc3RyaW5nIHwgQnVmZmVyLCB0b1N0cj86IGJvb2xlYW4pXG5cdHtcblx0XHRpZiAoIWlucHV0KVxuXHRcdHtcblx0XHRcdHJldHVybiBpbnB1dDtcblx0XHR9XG5cblx0XHRsZXQgaXNCdWZmZXIgPSBCdWZmZXIuaXNCdWZmZXIoaW5wdXQpO1xuXG5cdFx0aW5wdXQgPSBpbnB1dC50b1N0cmluZygpO1xuXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdGlucHV0ID0gc3RyaXBBbnNpKGlucHV0KSBhcyBzdHJpbmc7XG5cblx0XHRpZiAoaXNCdWZmZXIgJiYgIXRvU3RyKVxuXHRcdHtcblx0XHRcdHJldHVybiBCdWZmZXIuZnJvbShpbnB1dCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGlucHV0O1xuXHR9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENyb3NzU3Bhd25FeHRyYTtcbiJdfQ==